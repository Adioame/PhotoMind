{"version":3,"file":"performanceTestService-DWdX-NSS.js","sources":["../../../electron/services/modelLoadingService.ts","../../../electron/services/performanceTestService.ts"],"sourcesContent":["/**\n * PhotoMind - 模型加载服务\n *\n * 功能：\n * 1. 并行加载 face-api 和 CLIP 模型\n * 2. 总加载时间 < 10秒\n * 3. 提供模型加载进度指示\n */\nimport { faceDetectionService } from './faceDetectionService.js'\nimport { getEmbeddingService } from './hybridEmbeddingService.js'\n\nexport interface ModelLoadingProgress {\n  faceApi: {\n    loaded: boolean\n    progress: number // 0-100\n  }\n  clip: {\n    loaded: boolean\n    progress: number // 0-100\n  }\n  overall: number // 0-100\n  status: 'idle' | 'loading' | 'completed' | 'error'\n  error?: string\n}\n\nexport interface ModelLoadingResult {\n  success: boolean\n  faceApiLoaded: boolean\n  clipLoaded: boolean\n  totalTimeMs: number\n  faceApiTimeMs: number\n  clipTimeMs: number\n  error?: string\n}\n\nexport type LoadingProgressCallback = (progress: ModelLoadingProgress) => void\n\nclass ModelLoadingService {\n  private progress: ModelLoadingProgress = {\n    faceApi: { loaded: false, progress: 0 },\n    clip: { loaded: false, progress: 0 },\n    overall: 0,\n    status: 'idle'\n  }\n\n  private progressCallbacks: LoadingProgressCallback[] = []\n  private isLoading = false\n\n  /**\n   * 注册进度回调\n   */\n  onProgress(callback: LoadingProgressCallback): () => void {\n    this.progressCallbacks.push(callback)\n    return () => {\n      const index = this.progressCallbacks.indexOf(callback)\n      if (index > -1) {\n        this.progressCallbacks.splice(index, 1)\n      }\n    }\n  }\n\n  /**\n   * 通知所有回调\n   */\n  private notifyProgress(): void {\n    for (const callback of this.progressCallbacks) {\n      try {\n        callback({ ...this.progress })\n      } catch (e) {\n        console.error('[ModelLoading] Progress callback error:', e)\n      }\n    }\n  }\n\n  /**\n   * 更新 face-api 进度\n   */\n  private updateFaceApiProgress(progress: number, loaded: boolean = false): void {\n    this.progress.faceApi.progress = Math.min(100, Math.max(0, progress))\n    this.progress.faceApi.loaded = loaded\n    this.calculateOverallProgress()\n    this.notifyProgress()\n  }\n\n  /**\n   * 更新 CLIP 进度\n   */\n  private updateClipProgress(progress: number, loaded: boolean = false): void {\n    this.progress.clip.progress = Math.min(100, Math.max(0, progress))\n    this.progress.clip.loaded = loaded\n    this.calculateOverallProgress()\n    this.notifyProgress()\n  }\n\n  /**\n   * 计算总进度\n   */\n  private calculateOverallProgress(): void {\n    this.progress.overall = Math.round(\n      (this.progress.faceApi.progress + this.progress.clip.progress) / 2\n    )\n  }\n\n  /**\n   * 并行加载所有模型\n   */\n  async loadModels(): Promise<ModelLoadingResult> {\n    if (this.isLoading) {\n      return {\n        success: false,\n        faceApiLoaded: false,\n        clipLoaded: false,\n        totalTimeMs: 0,\n        faceApiTimeMs: 0,\n        clipTimeMs: 0,\n        error: 'Models are already loading'\n      }\n    }\n\n    this.isLoading = true\n    this.progress.status = 'loading'\n    this.progress.faceApi = { loaded: false, progress: 0 }\n    this.progress.clip = { loaded: false, progress: 0 }\n    this.progress.overall = 0\n    this.progress.error = undefined\n    this.notifyProgress()\n\n    const totalStartTime = Date.now()\n\n    try {\n      // 并行加载两个模型\n      const [faceApiResult, clipResult] = await Promise.all([\n        this.loadFaceApiModel(),\n        this.loadClipModel()\n      ])\n\n      const totalTimeMs = Date.now() - totalStartTime\n\n      this.progress.status = faceApiResult.success && clipResult.success ? 'completed' : 'error'\n      this.progress.faceApi.loaded = faceApiResult.success\n      this.progress.clip.loaded = clipResult.success\n\n      if (!faceApiResult.success || !clipResult.success) {\n        this.progress.error = faceApiResult.error || clipResult.error\n      }\n\n      this.notifyProgress()\n      this.isLoading = false\n\n      return {\n        success: faceApiResult.success && clipResult.success,\n        faceApiLoaded: faceApiResult.success,\n        clipLoaded: clipResult.success,\n        totalTimeMs,\n        faceApiTimeMs: faceApiResult.timeMs,\n        clipTimeMs: clipResult.timeMs,\n        error: faceApiResult.error || clipResult.error\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error)\n      this.progress.status = 'error'\n      this.progress.error = errorMessage\n      this.notifyProgress()\n      this.isLoading = false\n\n      return {\n        success: false,\n        faceApiLoaded: false,\n        clipLoaded: false,\n        totalTimeMs: Date.now() - totalStartTime,\n        faceApiTimeMs: 0,\n        clipTimeMs: 0,\n        error: errorMessage\n      }\n    }\n  }\n\n  /**\n   * 加载 face-api 模型\n   */\n  private async loadFaceApiModel(): Promise<{ success: boolean; timeMs: number; error?: string }> {\n    const startTime = Date.now()\n\n    try {\n      // 模拟进度更新\n      this.updateFaceApiProgress(10)\n      await this.delay(100)\n\n      this.updateFaceApiProgress(30)\n      const result = await faceDetectionService.loadModels()\n\n      const timeMs = Date.now() - startTime\n\n      if (result.success) {\n        this.updateFaceApiProgress(100, true)\n        return { success: true, timeMs }\n      } else {\n        this.updateFaceApiProgress(0, false)\n        return { success: false, timeMs, error: result.error }\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error)\n      this.updateFaceApiProgress(0, false)\n      return { success: false, timeMs: Date.now() - startTime, error: errorMessage }\n    }\n  }\n\n  /**\n   * 加载 CLIP 模型\n   */\n  private async loadClipModel(): Promise<{ success: boolean; timeMs: number; error?: string }> {\n    const startTime = Date.now()\n\n    try {\n      // 模拟进度更新\n      this.updateClipProgress(10)\n\n      const embeddingService = getEmbeddingService()\n\n      this.updateClipProgress(40)\n      const result = await embeddingService.initialize()\n\n      const timeMs = Date.now() - startTime\n\n      if (result.success) {\n        this.updateClipProgress(100, true)\n        return { success: true, timeMs }\n      } else {\n        this.updateClipProgress(0, false)\n        return { success: false, timeMs, error: result.error }\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error)\n      this.updateClipProgress(0, false)\n      return { success: false, timeMs: Date.now() - startTime, error: errorMessage }\n    }\n  }\n\n  /**\n   * 获取当前加载状态\n   */\n  getProgress(): ModelLoadingProgress {\n    return { ...this.progress }\n  }\n\n  /**\n   * 检查是否正在加载\n   */\n  isLoadingModels(): boolean {\n    return this.isLoading\n  }\n\n  /**\n   * 检查所有模型是否已加载\n   */\n  areModelsLoaded(): boolean {\n    return this.progress.faceApi.loaded && this.progress.clip.loaded\n  }\n\n  /**\n   * 延迟函数\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms))\n  }\n\n  /**\n   * 重置状态（用于测试）\n   */\n  reset(): void {\n    this.progress = {\n      faceApi: { loaded: false, progress: 0 },\n      clip: { loaded: false, progress: 0 },\n      overall: 0,\n      status: 'idle'\n    }\n    this.isLoading = false\n    this.progressCallbacks = []\n  }\n}\n\nexport const modelLoadingService = new ModelLoadingService()\n","/**\n * PhotoMind - 性能测试服务\n *\n * 功能：\n * 1. 搜索响应时间测试\n * 2. 内存占用测试\n * 3. 并发查询测试\n * 4. 模型加载时间测试\n */\nimport { PhotoDatabase } from '../database/db.js'\nimport { getEmbeddingService } from './hybridEmbeddingService.js'\nimport { faceDetectionService } from './faceDetectionService.js'\nimport { personService } from './personService.js'\nimport { modelLoadingService } from './modelLoadingService.js'\n\nexport interface PerformanceTestResult {\n  timestamp: string\n  searchPerformance: SearchPerformanceResult\n  memoryUsage: MemoryUsageResult\n  concurrencyTest: ConcurrencyTestResult\n  modelLoading: ModelLoadingResult\n  overallScore: number\n  recommendations: string[]\n}\n\nexport interface SearchPerformanceResult {\n  totalQueries: number\n  avgResponseTime: number\n  minResponseTime: number\n  maxResponseTime: number\n  p95ResponseTime: number\n  passRate: number // <500ms 的占比\n}\n\nexport interface MemoryUsageResult {\n  initialMemoryMB: number\n  peakMemoryMB: number\n  finalMemoryMB: number\n  deltaMB: number\n  pass: boolean // <500MB\n}\n\nexport interface ConcurrencyTestResult {\n  concurrentQueries: number\n  avgResponseTime: number\n  successRate: number\n  pass: boolean\n}\n\nexport interface ModelLoadingResult {\n  faceApiLoadTimeMs: number\n  clipLoadTimeMs: number\n  totalLoadTimeMs: number\n  parallelLoading: boolean\n  pass: boolean // <10s\n}\n\nexport class PerformanceTestService {\n  private database: PhotoDatabase\n\n  constructor(database?: PhotoDatabase) {\n    this.database = database || new PhotoDatabase()\n  }\n\n  /**\n   * 测试搜索性能\n   */\n  async testSearchPerformance(queryCount: number = 50): Promise<SearchPerformanceResult> {\n    console.log(`[PerformanceTest] 测试搜索性能: ${queryCount} 次查询`)\n\n    const testQueries = [\n      '公园', '海边', '生日', '风景', '家庭',\n      '朋友聚会', '旅行', '美食', '宠物', '日落',\n      '我和妈妈在公园', '朋友在海边', '生日派对',\n      '风景照片', '宠物狗', '室内', '户外', '自然'\n    ]\n\n    const responseTimes: number[] = []\n    const embeddingService = getEmbeddingService()\n\n    for (let i = 0; i < queryCount; i++) {\n      const query = testQueries[i % testQueries.length]\n      const startTime = Date.now()\n\n      try {\n        await embeddingService.textToEmbedding(query)\n        responseTimes.push(Date.now() - startTime)\n      } catch (error) {\n        responseTimes.push(-1) // 标记失败\n      }\n    }\n\n    const validTimes = responseTimes.filter(t => t > 0)\n    const sortedTimes = [...validTimes].sort((a, b) => a - b)\n\n    const avgResponseTime = validTimes.length > 0\n      ? validTimes.reduce((a, b) => a + b, 0) / validTimes.length\n      : 0\n\n    const minResponseTime = sortedTimes[0] || 0\n    const maxResponseTime = sortedTimes[sortedTimes.length - 1] || 0\n    const p95Index = Math.floor(sortedTimes.length * 0.95)\n    const p95ResponseTime = sortedTimes[p95Index] || maxResponseTime\n\n    const passCount = validTimes.filter(t => t < 500).length\n    const passRate = validTimes.length > 0 ? passCount / validTimes.length : 0\n\n    console.log(`[PerformanceTest] 搜索性能测试结果:`)\n    console.log(`  - 平均响应时间: ${avgResponseTime.toFixed(1)}ms`)\n    console.log(`  - P95 响应时间: ${p95ResponseTime.toFixed(1)}ms`)\n    console.log(`  - 通过率: ${(passRate * 100).toFixed(1)}%`)\n\n    return {\n      totalQueries: queryCount,\n      avgResponseTime,\n      minResponseTime,\n      maxResponseTime,\n      p95ResponseTime,\n      passRate\n    }\n  }\n\n  /**\n   * 测试内存占用\n   */\n  async testMemoryUsage(): Promise<MemoryUsageResult> {\n    console.log('[PerformanceTest] 测试内存占用...')\n\n    if (typeof process === 'undefined' || !process.memoryUsage) {\n      return {\n        initialMemoryMB: 0,\n        peakMemoryMB: 0,\n        finalMemoryMB: 0,\n        deltaMB: 0,\n        pass: true\n      }\n    }\n\n    const initialMemory = process.memoryUsage()\n    const initialMB = initialMemory.heapUsed / 1024 / 1024\n\n    // 执行一些内存密集型操作\n    const embeddingService = getEmbeddingService()\n    const testQueries = Array(100).fill('测试查询')\n\n    let peakMB = initialMB\n\n    for (const query of testQueries) {\n      try {\n        await embeddingService.textToEmbedding(query)\n        const current = process.memoryUsage()\n        const currentMB = current.heapUsed / 1024 / 1024\n        if (currentMB > peakMB) peakMB = currentMB\n      } catch (e) {\n        // 忽略错误\n      }\n    }\n\n    // 触发垃圾回收（如果可用）\n    if (global.gc) {\n      global.gc()\n    }\n\n    const finalMemory = process.memoryUsage()\n    const finalMB = finalMemory.heapUsed / 1024 / 1024\n\n    console.log(`[PerformanceTest] 内存占用测试结果:`)\n    console.log(`  - 初始: ${initialMB.toFixed(1)}MB`)\n    console.log(`  - 峰值: ${peakMB.toFixed(1)}MB`)\n    console.log(`  - 最终: ${finalMB.toFixed(1)}MB`)\n\n    return {\n      initialMemoryMB: initialMB,\n      peakMemoryMB: peakMB,\n      finalMemoryMB: finalMB,\n      deltaMB: finalMB - initialMB,\n      pass: peakMB < 500\n    }\n  }\n\n  /**\n   * 测试并发查询\n   */\n  async testConcurrency(concurrentCount: number = 5): Promise<ConcurrencyTestResult> {\n    console.log(`[PerformanceTest] 测试并发查询: ${concurrentCount} 并发`)\n\n    const embeddingService = getEmbeddingService()\n    const testQueries = Array(concurrentCount).fill('并发测试查询')\n\n    const startTime = Date.now()\n\n    try {\n      // 并发执行\n      const promises = testQueries.map(q =>\n        embeddingService.textToEmbedding(q)\n      )\n\n      const results = await Promise.allSettled(promises)\n      const totalTime = Date.now() - startTime\n\n      const successCount = results.filter(r => r.status === 'fulfilled').length\n      const successRate = successCount / concurrentCount\n\n      console.log(`[PerformanceTest] 并发测试结果:`)\n      console.log(`  - 总耗时: ${totalTime}ms`)\n      console.log(`  - 成功率: ${(successRate * 100).toFixed(1)}%`)\n\n      return {\n        concurrentQueries: concurrentCount,\n        avgResponseTime: totalTime / concurrentCount,\n        successRate,\n        pass: successRate >= 0.9\n      }\n    } catch (error) {\n      console.error('[PerformanceTest] 并发测试失败:', error)\n      return {\n        concurrentQueries: concurrentCount,\n        avgResponseTime: 0,\n        successRate: 0,\n        pass: false\n      }\n    }\n  }\n\n  /**\n   * 测试模型加载时间（使用并行加载）\n   */\n  async testModelLoading(): Promise<ModelLoadingResult> {\n    console.log('[PerformanceTest] 测试模型加载时间（并行加载）...')\n\n    // 重置模型加载服务状态\n    modelLoadingService.reset()\n\n    // 记录进度更新\n    const progressUpdates: Array<{ faceApi: number; clip: number; overall: number }> = []\n    const unsubscribe = modelLoadingService.onProgress((progress) => {\n      progressUpdates.push({\n        faceApi: progress.faceApi.progress,\n        clip: progress.clip.progress,\n        overall: progress.overall\n      })\n    })\n\n    // 使用并行加载服务\n    const result = await modelLoadingService.loadModels()\n\n    // 取消订阅\n    unsubscribe()\n\n    console.log(`[PerformanceTest] 模型加载测试结果:`)\n    console.log(`  - Face-API: ${result.faceApiTimeMs}ms (${result.faceApiLoaded ? '成功' : '失败'})`)\n    console.log(`  - CLIP: ${result.clipTimeMs}ms (${result.clipLoaded ? '成功' : '失败'})`)\n    console.log(`  - 总计: ${result.totalTimeMs}ms`)\n    console.log(`  - 并行加载: 是`)\n    console.log(`  - 进度更新次数: ${progressUpdates.length}`)\n\n    return {\n      faceApiLoadTimeMs: result.faceApiTimeMs,\n      clipLoadTimeMs: result.clipTimeMs,\n      totalLoadTimeMs: result.totalTimeMs,\n      parallelLoading: true,\n      pass: result.success && result.totalTimeMs < 10000\n    }\n  }\n\n  /**\n   * 运行完整性能测试\n   */\n  async runFullTest(): Promise<PerformanceTestResult> {\n    console.log('[PerformanceTest] 开始完整性能测试...')\n\n    const searchPerformance = await this.testSearchPerformance(50)\n    const memoryUsage = await this.testMemoryUsage()\n    const concurrencyTest = await this.testConcurrency(5)\n    const modelLoading = await this.testModelLoading()\n\n    // 计算综合分数\n    const searchScore = searchPerformance.passRate * 100\n    const memoryScore = memoryUsage.pass ? 100 : Math.max(0, 100 - (memoryUsage.peakMemoryMB - 500) / 10)\n    const concurrencyScore = concurrencyTest.pass ? 100 : concurrencyTest.successRate * 100\n    const modelScore = modelLoading.pass ? 100 : Math.max(0, 100 - (modelLoading.totalLoadTimeMs - 10000) / 100)\n\n    const overallScore = (searchScore + memoryScore + concurrencyScore + modelScore) / 4\n\n    // 生成建议\n    const recommendations: string[] = []\n\n    if (searchPerformance.passRate < 0.95) {\n      recommendations.push(`搜索响应时间不达标，通过率=${(searchPerformance.passRate * 100).toFixed(0)}%，P95=${searchPerformance.p95ResponseTime.toFixed(0)}ms，建议优化`)\n    }\n    if (!memoryUsage.pass) {\n      recommendations.push(`内存占用过高，峰值=${memoryUsage.peakMemoryMB.toFixed(0)}MB，建议检查内存泄漏`)\n    }\n    if (!concurrencyTest.pass) {\n      recommendations.push(`并发查询成功率低 (${(concurrencyTest.successRate * 100).toFixed(0)}%)，建议检查并发处理`)\n    }\n    if (!modelLoading.pass) {\n      recommendations.push(`模型加载时间过长 (${modelLoading.totalLoadTimeMs}ms)，建议启用并行加载`)\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push('性能测试全部通过，系统运行良好')\n    }\n\n    return {\n      timestamp: new Date().toISOString(),\n      searchPerformance,\n      memoryUsage,\n      concurrencyTest,\n      modelLoading,\n      overallScore,\n      recommendations\n    }\n  }\n}\n\nexport const performanceTestService = new PerformanceTestService()\n"],"names":[],"mappings":"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"}