{"version":3,"file":"searchResultFormatter-RYSqGMUP.js","sources":["../../../electron/services/searchResultFormatter.ts"],"sourcesContent":["/**\n * PhotoMind - 搜索结果格式化服务\n *\n * 功能：\n * 1. 统一格式化搜索结果\n * 2. 添加相似度标签\n * 3. 转换为前端友好格式\n */\n\nexport interface FormattedSearchResult {\n  id: string\n  fileName: string\n  filePath: string\n  thumbnailUrl?: string\n  similarity: number\n  similarityPercent: number\n  similarityLabel: 'high' | 'medium' | 'low'\n  takenAt?: string\n  takenYear?: number\n  takenMonth?: number\n  location?: {\n    name?: string\n    latitude?: number\n    longitude?: number\n  }\n  exif?: {\n    camera?: string\n    lens?: string\n    aperture?: number\n    iso?: number\n  }\n  rank: number\n}\n\nexport interface SearchResultSummary {\n  totalResults: number\n  displayedResults: number\n  page: number\n  totalPages: number\n  processingTimeMs: number\n  query: string\n  language: string\n}\n\nexport class SearchResultFormatter {\n  /**\n   * 格式化单个搜索结果\n   */\n  format(result: any): FormattedSearchResult {\n    const photo = result.photo || {}\n\n    // 提取年月\n    let takenYear: number | undefined\n    let takenMonth: number | undefined\n    if (photo.takenAt) {\n      const date = new Date(photo.takenAt)\n      takenYear = date.getFullYear()\n      takenMonth = date.getMonth() + 1\n    }\n\n    return {\n      id: result.photoUuid,\n      fileName: photo.fileName || '',\n      filePath: photo.filePath || '',\n      thumbnailUrl: photo.thumbnailPath,\n      similarity: result.similarity,\n      similarityPercent: Math.round(result.similarity * 100),\n      similarityLabel: this.getSimilarityLabel(result.similarity),\n      takenAt: photo.takenAt,\n      takenYear,\n      takenMonth,\n      location: photo.location,\n      exif: {\n        camera: photo.exif?.camera,\n        lens: photo.exif?.lens,\n        aperture: photo.exif?.aperture,\n        iso: photo.exif?.iso\n      },\n      rank: result.rank || 0\n    }\n  }\n\n  /**\n   * 批量格式化搜索结果\n   */\n  formatBatch(results: any[]): FormattedSearchResult[] {\n    return results.map((r, index) => ({\n      ...this.format(r),\n      rank: r.rank || index + 1\n    }))\n  }\n\n  /**\n   * 生成搜索摘要\n   */\n  formatSummary(result: any): SearchResultSummary {\n    return {\n      totalResults: result.total || result.results?.length || 0,\n      displayedResults: result.results?.length || 0,\n      page: result.page || 1,\n      totalPages: Math.ceil((result.total || 0) / (result.pageSize || 20)),\n      processingTimeMs: result.processingTimeMs || 0,\n      query: result.query?.original || '',\n      language: result.query?.language || 'unknown'\n    }\n  }\n\n  /**\n   * 获取相似度标签\n   */\n  private getSimilarityLabel(similarity: number): 'high' | 'medium' | 'low' {\n    if (similarity >= 0.7) return 'high'\n    if (similarity >= 0.4) return 'medium'\n    return 'low'\n  }\n\n  /**\n   * 相似度转换为百分比\n   */\n  similarityToPercent(similarity: number): number {\n    return Math.round(similarity * 100)\n  }\n\n  /**\n   * 按年份分组结果\n   */\n  groupByYear(results: FormattedSearchResult[]): Map<number, FormattedSearchResult[]> {\n    const groups = new Map<number, FormattedSearchResult[]>()\n\n    for (const result of results) {\n      const year = result.takenYear || 0\n      if (year > 0) {\n        const existing = groups.get(year) || []\n        existing.push(result)\n        groups.set(year, existing)\n      }\n    }\n\n    return groups\n  }\n\n  /**\n   * 按地点分组结果\n   */\n  groupByLocation(results: FormattedSearchResult[]): Map<string, FormattedSearchResult[]> {\n    const groups = new Map<string, FormattedSearchResult[]>()\n\n    for (const result of results) {\n      const locationName = result.location?.name || '未知地点'\n      const existing = groups.get(locationName) || []\n      existing.push(result)\n      groups.set(locationName, existing)\n    }\n\n    return groups\n  }\n\n  /**\n   * 生成高亮文本（模拟）\n   */\n  generateHighlightedQuery(processedQuery: string): string {\n    // 返回处理后的查询文本\n    return processedQuery\n  }\n\n  /**\n   * 估算搜索质量\n   */\n  estimateSearchQuality(results: FormattedSearchResult[]): 'excellent' | 'good' | 'fair' | 'poor' {\n    if (results.length === 0) return 'poor'\n\n    // 计算高质量结果比例（相似度 > 0.5）\n    const highQualityCount = results.filter(r => r.similarity >= 0.5).length\n    const ratio = highQualityCount / results.length\n\n    if (ratio >= 0.8) return 'excellent'\n    if (ratio >= 0.5) return 'good'\n    if (ratio >= 0.3) return 'fair'\n    return 'poor'\n  }\n}\n\nexport const searchResultFormatter = new SearchResultFormatter()\n"],"names":[],"mappings":"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"}