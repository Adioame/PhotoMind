{"version":3,"file":"qualityValidationService-Ch5EaGkJ.js","sources":["../../../electron/services/qualityValidationService.ts"],"sourcesContent":["/**\n * PhotoMind - 质量验证服务\n *\n * 功能：\n * 1. 聚类质量验证\n * 2. 语义搜索验证\n * 3. 生成质量报告\n */\nimport { PhotoDatabase } from '../database/db.js'\nimport { faceMatchingService } from './faceMatchingService.js'\nimport { personService } from './personService.js'\nimport { getEmbeddingService } from './hybridEmbeddingService.js'\n\nexport interface ClusteringQualityResult {\n  totalPersons: number\n  totalFaces: number\n  avgFacesPerPerson: number\n  samePersonSimilarities: number[]\n  differentPersonSimilarities: number[]\n  samePersonAvg: number\n  differentPersonAvg: number\n  passRate: number // 同一人>0.6的占比\n  boundaryCases: Array<{\n    personId: number\n    personName: string\n    faceCount: number\n    avgInternalSimilarity: number\n  }>\n}\n\nexport interface SemanticSearchTestResult {\n  query: string\n  expectedConcepts: string[]\n  results: Array<{\n    photoUuid: string\n    similarity: number\n    hasFace: boolean\n    isOutdoor: boolean\n  }>\n  relevanceScore: number\n  responseTimeMs: number\n}\n\nexport interface QualityReport {\n  clustering: ClusteringQualityResult\n  semanticSearch: SemanticSearchTestResult[]\n  overallScore: number\n  recommendations: string[]\n  timestamp: string\n}\n\nexport class QualityValidationService {\n  private database: PhotoDatabase\n\n  constructor(database?: PhotoDatabase) {\n    this.database = database || new PhotoDatabase()\n  }\n\n  /**\n   * 计算余弦相似度\n   */\n  private cosineSimilarity(a: number[], b: number[]): number {\n    if (!a || !b || a.length === 0 || b.length === 0) return 0\n    const len = Math.min(a.length, b.length)\n    let dot = 0, normA = 0, normB = 0\n    for (let i = 0; i < len; i++) {\n      dot += a[i] * b[i]\n      normA += a[i] * a[i]\n      normB += b[i] * b[i]\n    }\n    if (normA === 0 || normB === 0) return 0\n    return dot / (Math.sqrt(normA) * Math.sqrt(normB))\n  }\n\n  /**\n   * 验证聚类质量\n   */\n  async validateClustering(): Promise<ClusteringQualityResult> {\n    console.log('[QualityValidation] 开始验证聚类质量...')\n\n    const persons = personService.getAllPersons()\n    const allFaces = await faceMatchingService.getAllFaceDescriptors()\n\n    const samePersonSimilarities: number[] = []\n    const differentPersonSimilarities: number[] = []\n    const boundaryCases: Array<{\n      personId: number\n      personName: string\n      faceCount: number\n      avgInternalSimilarity: number\n    }> = []\n\n    // 计算每个人物内部的人脸相似度\n    for (const person of persons) {\n      const personFaces = allFaces.filter(f => f.personId === person.id)\n      if (personFaces.length < 2) continue\n\n      const internalSimilarities: number[] = []\n      for (let i = 0; i < personFaces.length; i++) {\n        for (let j = i + 1; j < personFaces.length; j++) {\n          const sim = this.cosineSimilarity(\n            personFaces[i].descriptor,\n            personFaces[j].descriptor\n          )\n          internalSimilarities.push(sim)\n          samePersonSimilarities.push(sim)\n        }\n      }\n\n      const avgInternalSim = internalSimilarities.length > 0\n        ? internalSimilarities.reduce((a, b) => a + b, 0) / internalSimilarities.length\n        : 0\n\n      // 如果平均相似度 < 0.6，标记为边界案例\n      if (avgInternalSim < 0.6 && avgInternalSim > 0.3) {\n        boundaryCases.push({\n          personId: person.id,\n          personName: person.display_name || person.name,\n          faceCount: personFaces.length,\n          avgInternalSimilarity: avgInternalSim\n        })\n      }\n    }\n\n    // 计算不同人物之间的相似度（采样）\n    const sampleSize = Math.min(persons.length, 10)\n    for (let i = 0; i < sampleSize; i++) {\n      const personA = persons[i]\n      const facesA = allFaces.filter(f => f.personId === personA.id)\n      if (facesA.length === 0) continue\n\n      for (let j = i + 1; j < sampleSize; j++) {\n        const personB = persons[j]\n        const facesB = allFaces.filter(f => f.personId === personB.id)\n        if (facesB.length === 0) continue\n\n        // 计算两个组之间的平均相似度\n        let totalSim = 0\n        let count = 0\n        for (const faceA of facesA.slice(0, 3)) {\n          for (const faceB of facesB.slice(0, 3)) {\n            totalSim += this.cosineSimilarity(faceA.descriptor, faceB.descriptor)\n            count++\n          }\n        }\n        if (count > 0) {\n          differentPersonSimilarities.push(totalSim / count)\n        }\n      }\n    }\n\n    const samePersonAvg = samePersonSimilarities.length > 0\n      ? samePersonSimilarities.reduce((a, b) => a + b, 0) / samePersonSimilarities.length\n      : 0\n\n    const differentPersonAvg = differentPersonSimilarities.length > 0\n      ? differentPersonSimilarities.reduce((a, b) => a + b, 0) / differentPersonSimilarities.length\n      : 0\n\n    // 计算通过率（同一人相似度 > 0.6 的占比）\n    const passCount = samePersonSimilarities.filter(s => s > 0.6).length\n    const passRate = samePersonSimilarities.length > 0\n      ? passCount / samePersonSimilarities.length\n      : 0\n\n    console.log(`[QualityValidation] 聚类质量验证完成:`)\n    console.log(`  - 人物数量: ${persons.length}`)\n    console.log(`  - 同一人平均相似度: ${samePersonAvg.toFixed(3)}`)\n    console.log(`  - 不同人平均相似度: ${differentPersonAvg.toFixed(3)}`)\n    console.log(`  - 通过率: ${(passRate * 100).toFixed(1)}%`)\n\n    return {\n      totalPersons: persons.length,\n      totalFaces: allFaces.length,\n      avgFacesPerPerson: persons.length > 0 ? allFaces.length / persons.length : 0,\n      samePersonSimilarities,\n      differentPersonSimilarities,\n      samePersonAvg,\n      differentPersonAvg,\n      passRate,\n      boundaryCases\n    }\n  }\n\n  /**\n   * 测试语义搜索\n   */\n  async testSemanticSearch(\n    query: string,\n    expectedConcepts: string[] = []\n  ): Promise<SemanticSearchTestResult> {\n    console.log(`[QualityValidation] 测试语义搜索: \"${query}\"`)\n\n    const startTime = Date.now()\n\n    try {\n      const embeddingService = getEmbeddingService()\n      const result = await embeddingService.textToEmbedding(query)\n\n      const responseTimeMs = Date.now() - startTime\n\n      if (!result.success || !result.vector) {\n        return {\n          query,\n          expectedConcepts,\n          results: [],\n          relevanceScore: 0,\n          responseTimeMs\n        }\n      }\n\n      // 获取所有照片向量\n      const allEmbeddings = await this.database.getAllEmbeddings('image')\n\n      // 计算相似度\n      const queryVector = result.vector.values || (result.vector as any)\n      const similarities = allEmbeddings.map(emb => ({\n        photoUuid: emb.photoUuid,\n        similarity: this.cosineSimilarity(queryVector, emb.vector),\n        hasFace: false,\n        isOutdoor: false\n      }))\n\n      // 排序并取前 10\n      similarities.sort((a, b) => b.similarity - a.similarity)\n      const topResults = similarities.slice(0, 10)\n\n      // 计算相关性分数（平均相似度）\n      const relevanceScore = topResults.length > 0\n        ? topResults.reduce((sum, r) => sum + r.similarity, 0) / topResults.length\n        : 0\n\n      console.log(`[QualityValidation] 语义搜索完成:`)\n      console.log(`  - 响应时间: ${responseTimeMs}ms`)\n      console.log(`  - 相关性分数: ${relevanceScore.toFixed(3)}`)\n\n      return {\n        query,\n        expectedConcepts,\n        results: topResults,\n        relevanceScore,\n        responseTimeMs\n      }\n    } catch (error) {\n      console.error('[QualityValidation] 语义搜索测试失败:', error)\n      return {\n        query,\n        expectedConcepts,\n        results: [],\n        relevanceScore: 0,\n        responseTimeMs: Date.now() - startTime\n      }\n    }\n  }\n\n  /**\n   * 运行标准测试集\n   */\n  async runStandardTests(): Promise<SemanticSearchTestResult[]> {\n    const testQueries = [\n      { query: '我和妈妈在公园', expectedConcepts: ['人', '公园', '户外'] },\n      { query: '朋友在海边', expectedConcepts: ['人', '海', '户外'] },\n      { query: '生日派对', expectedConcepts: ['庆祝', '室内', '人'] },\n      { query: '风景照片', expectedConcepts: ['风景', '自然'] },\n      { query: '宠物狗', expectedConcepts: ['狗', '动物'] }\n    ]\n\n    const results: SemanticSearchTestResult[] = []\n    for (const { query, expectedConcepts } of testQueries) {\n      const result = await this.testSemanticSearch(query, expectedConcepts)\n      results.push(result)\n    }\n\n    return results\n  }\n\n  /**\n   * 生成完整质量报告\n   */\n  async generateReport(): Promise<QualityReport> {\n    console.log('[QualityValidation] 生成完整质量报告...')\n\n    const clustering = await this.validateClustering()\n    const semanticSearch = await this.runStandardTests()\n\n    // 计算综合分数\n    const clusteringScore = clustering.passRate * 100\n    const semanticScore = semanticSearch.length > 0\n      ? (semanticSearch.reduce((sum, r) => sum + r.relevanceScore, 0) / semanticSearch.length) * 100\n      : 0\n    const overallScore = (clusteringScore + semanticScore) / 2\n\n    // 生成建议\n    const recommendations: string[] = []\n\n    if (clustering.passRate < 0.7) {\n      recommendations.push('聚类质量偏低，建议重新调整聚类阈值或重新生成向量')\n    }\n    if (clustering.boundaryCases.length > 0) {\n      recommendations.push(`发现 ${clustering.boundaryCases.length} 个人物需要人工检查`)\n    }\n    if (semanticScore < 50) {\n      recommendations.push('语义搜索质量偏低，建议检查 CLIP 模型加载状态')\n    }\n\n    const avgResponseTime = semanticSearch.length > 0\n      ? semanticSearch.reduce((sum, r) => sum + r.responseTimeMs, 0) / semanticSearch.length\n      : 0\n    if (avgResponseTime > 500) {\n      recommendations.push(`搜索响应时间较长 (${avgResponseTime.toFixed(0)}ms)，建议优化性能`)\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push('系统质量良好，无需调整')\n    }\n\n    return {\n      clustering,\n      semanticSearch,\n      overallScore,\n      recommendations,\n      timestamp: new Date().toISOString()\n    }\n  }\n\n  /**\n   * 检查向量维度\n   */\n  async checkVectorDimensions(): Promise<{\n    faceEmbeddingDim: number\n    semanticEmbeddingDim: number\n    validFaces: number\n    invalidFaces: number\n  }> {\n    const faces = this.database.query(`\n      SELECT id, face_embedding, semantic_embedding\n      FROM detected_faces\n      WHERE vector_version >= 1\n    `)\n\n    let validFaces = 0\n    let invalidFaces = 0\n    let faceEmbeddingDim = 0\n    let semanticEmbeddingDim = 0\n\n    for (const face of faces) {\n      try {\n        if (face.face_embedding) {\n          const arr = new Float32Array(face.face_embedding)\n          faceEmbeddingDim = arr.length\n          if (arr.length === 128) validFaces++\n          else invalidFaces++\n        }\n        if (face.semantic_embedding) {\n          const arr = new Float32Array(face.semantic_embedding)\n          semanticEmbeddingDim = arr.length\n        }\n      } catch (e) {\n        invalidFaces++\n      }\n    }\n\n    return {\n      faceEmbeddingDim,\n      semanticEmbeddingDim,\n      validFaces,\n      invalidFaces\n    }\n  }\n}\n\nexport const qualityValidationService = new QualityValidationService()\n"],"names":[],"mappings":"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"}