# 1. 概述与需求清单

## Overview

This document provides the complete epic and story breakdown for PhotoMind, decomposing the requirements from the PRD, UX Design (if it exists), and Architecture requirements into implementable stories.

## Requirements Inventory

### Functional Requirements

**FR-01.1**: iCloud 照片选择 - 用户可以选择 iCloud 照片库
**FR-01.2**: iCloud 照片同步 - 同步 iCloud 中的照片到本地
**FR-01.3**: 本地文件夹导入 - 用户可以选择本地文件夹批量导入
**FR-01.4**: 支持的照片格式 - JPG, PNG, HEIC, RAW
**FR-01.5**: 进度显示 - 显示导入进度和状态
**FR-01.6**: 元数据提取 - 自动提取 EXIF 日期、位置、设备信息
**FR-02.1**: 自然语言输入 - 支持任意自然语言查询
**FR-02.2**: LLM 解析 - 调用 LLM API 解析查询意图
**FR-02.3**: 时间条件解析 - 支持"去年"、"上个月"、"2024年"等
**FR-02.4**: 地点条件解析 - 支持地点名称、相对位置
**FR-02.5**: 语义意图提取 - 提取描述性关键词用于向量搜索
**FR-02.6**: 关键词搜索 - 基于解析条件执行 SQL 查询
**FR-02.7**: 全局向量搜索 - 在整个照片库执行语义相似度搜索
**FR-02.8**: 候选集向量搜索 - 在关键词结果中执行向量搜索
**FR-02.9**: 结果融合 - 关键词结果 + 向量结果加权合并
**FR-02.10**: 置信度排序 - 按综合置信度降序排列
**FR-03.1**: CLIP 模型加载 - 支持本地加载 CLIP 模型
**FR-03.2**: 文本转向量 - 自然语言查询转为 512 维向量
**FR-03.3**: 图片转向量 - 照片转为 CLIP 向量存储
**FR-03.4**: 向量存储 - 存入 SQLite vectors 表
**FR-03.5**: 余弦相似度搜索 - 在向量表中搜索相似向量
**FR-03.6**: 批量向量生成 - 遍历照片库生成所有向量
**FR-03.7**: 增量向量生成 - 新照片导入时自动生成向量
**FR-04.1**: 手动标记人物 - 用户可为照片添加人物标签
**FR-04.2**: 人脸特征提取 - 标记时自动提取人脸编码
**FR-04.3**: 自动人脸检测 - 导入时自动检测照片中的人脸
**FR-04.4**: 人脸自动匹配 - 与已知人物特征比对并关联
**FR-04.5**: 置信度提示 - 低置信度匹配需用户确认
**FR-04.6**: 人物搜索 - 支持"妈妈的照片"、"和爸爸的合影"
**FR-04.7**: 人物相册 - 自动生成人物照片合集

### NonFunctional Requirements

**NFR-01**: 搜索响应时间 < 3 秒 (性能)
**NFR-02**: 照片加载时间 < 1 秒（100 张） (性能)
**NFR-03**: 内存占用 < 500MB（10000 张照片） (性能)
**NFR-04**: 冷启动时间 < 10 秒 (性能)
**NFR-05**: 本地数据加密存储 (安全)
**NFR-06**: LLM API Key 安全存储 (安全)
**NFR-07**: iCloud 访问令牌安全管理 (安全)
**NFR-08**: 用户隐私数据本地处理 (安全)
**NFR-09**: macOS 12+ (Monterey) (兼容性)
**NFR-10**: iCloud Photos Library 兼容性 (兼容性)
**NFR-11**: HEIC/HEIF 格式支持 (兼容性)
**NFR-12**: 深色/浅色主题 (可用性)
**NFR-13**: 支持键盘快捷键 (可用性)
**NFR-14**: 无障碍访问支持 (可用性)

### Additional Requirements

**T-01**: 使用 Electron 35 主进程 + IPC 架构
**T-02**: 使用 Vue 3 + Pinia + Vue Router
**T-03**: 使用 sql.js 嵌入式 SQLite
**T-04**: 使用 OpenAI/DeepSeek API 进行自然语言处理
**T-05**: 使用 @xenova/transformers (CLIP) 进行向量计算
**T-06**: 数据库表结构：photos, faces, persons, vectors, tags, photo_tags, albums
**T-07**: IPC 接口：photos:search（需改为语义搜索）

## Epic List

| Epic | 名称 | 优先级 | User Stories |
|------|------|--------|--------------|
| **E-01** | 数据导入层 | P0 | 4 |
| **E-02** | CLIP 语义搜索 | P0 | 5 |
| **E-03** | 混合搜索服务 | P0 | 4 |
| **E-04** | 人物管理系统 | P1 | 4 |
| **E-05** | 用户界面增强 | P2 | 3 |

## FR Coverage Map

| FR | Epic | 描述 |
|----|------|------|
| FR-01.1 | E-01 | iCloud 照片选择 |
| FR-01.2 | E-01 | iCloud 照片同步 |
| FR-01.3 | E-01 | 本地文件夹导入 |
| FR-01.4 | E-01 | 支持的照片格式 |
| FR-01.5 | E-01 | 进度显示 |
| FR-01.6 | E-01 | 元数据提取 |
| FR-02.1 | E-03 | 自然语言输入 |
| FR-02.2 | E-03 | LLM 解析 |
| FR-02.3 | E-03 | 时间条件解析 |
| FR-02.4 | E-03 | 地点条件解析 |
| FR-02.5 | E-03 | 语义意图提取 |
| FR-02.6 | E-03 | 关键词搜索 |
| FR-02.7 | E-03 | 全局向量搜索 |
| FR-02.8 | E-03 | 候选集向量搜索 |
| FR-02.9 | E-03 | 结果融合 |
| FR-02.10 | E-03 | 置信度排序 |
| FR-03.1 | E-02 | CLIP 模型加载 |
| FR-03.2 | E-02 | 文本转向量 |
| FR-03.3 | E-02 | 图片转向量 |
| FR-03.4 | E-02 | 向量存储 |
| FR-03.5 | E-02 | 余弦相似度搜索 |
| FR-03.6 | E-02 | 批量向量生成 |
| FR-03.7 | E-02 | 增量向量生成 |
| FR-04.1 | E-04 | 手动标记人物 |
| FR-04.2 | E-04 | 人脸特征提取 |
| FR-04.3 | E-04 | 自动人脸检测 |
| FR-04.4 | E-04 | 人脸自动匹配 |
| FR-04.5 | E-04 | 置信度提示 |
| FR-04.6 | E-04 | 人物搜索 |
| FR-04.7 | E-04 | 人物相册 |
