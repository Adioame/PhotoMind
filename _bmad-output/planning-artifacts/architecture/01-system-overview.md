# 1. 系统架构概览

## 1.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         PhotoMind App                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Electron 主进程 (Main Process)                │   │
│  │  ┌─────────────┬─────────────┬─────────────────────────┐ │   │
│  │  │ IPC Handler │  Services   │      Database           │ │   │
│  │  │             │             │                         │ │   │
│  │  │ • Main      │ • iCloud   │  • sql.js (SQLite)      │ │   │
│  │  │ • Window    │ • LocalPhoto│  • photos table        │ │   │
│  │  │ • App       │ • Search    │  • vectors table        │ │   │
│  │  │             │ • Embedding │  • faces table         │ │   │
│  │  │             │ • FaceRec   │  • persons table       │ │   │
│  │  └─────────────┴─────────────┴─────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                            ▲                                     │
│                   IPC (Preload Bridge)                          │
│                            ▼                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Vue 3 渲染进程 (Renderer Process)          │   │
│  │  ┌─────────────┬─────────────┬─────────────────────────┐ │   │
│  │  │ Vue Router  │   Pinia     │     Views & Components │ │   │
│  │  │             │   Stores    │                         │ │   │
│  │  │ • Router    │ • photoStore│  • PhotosView         │ │   │
│  │  │ • Routes    │ • searchStore│  • SearchView         │ │   │
│  │  │             │ • peopleStore│  • TimelineView       │ │   │
│  │  │             │             │  • PeopleView          │ │   │
│  │  └─────────────┴─────────────┴─────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## 1.2 进程职责

| 进程 | 职责 | 技术 |
|------|------|------|
| **主进程** | 窗口管理、文件系统访问、服务层、数据库操作 | Electron 35, TypeScript |
| **渲染进程** | UI 渲染、用户交互、状态管理 | Vue 3, Pinia, Naive UI |

## 1.3 进程通信

```
渲染进程                                          主进程
    │                                                │
    │  ipcRenderer.invoke('channel', data)           │
    ├───────────────────────────────────────────────►│
    │                                                │
    │                                        处理请求 │
    │                                                │
    │  ipcRenderer.handle('channel', handler)         │
    │◄──────────────────────────────────────────────┤
    │                                                │
```

**通信模式:**
- **请求-响应**: 使用 `invoke`/`handle` 进行同步调用
- **事件推送**: 使用 `send`/`on` 进行异步通知
- **进度回调**: 用于长时间运行的任务（导入、向量生成）
