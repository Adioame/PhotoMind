# Story E-09: äººç‰©é¡µé¢å¯¼èˆªé‡æ„

## åŸºæœ¬ä¿¡æ¯

| å­—æ®µ | å€¼ |
|------|-----|
| **Story ID** | E-09 |
| **æ‰€å± Epic** | UX ä¼˜åŒ– |
| **çŠ¶æ€** | âœ… Done |
| **è´Ÿè´£äºº** | UX Designer (Sally) |
| **å¼€å§‹æ—¥æœŸ** | 2026-02-06 |
| **å®Œæˆæ—¥æœŸ** | 2026-02-06 |

---

## é—®é¢˜æè¿°

ç”¨æˆ·åœ¨äººç‰©è¯¦æƒ…é¡µé¢æµè§ˆç…§ç‰‡åï¼Œä»ç…§ç‰‡è¯¦æƒ…é¡µè¿”å›æ—¶ï¼Œæ— æ³•æ­£ç¡®è¿”å›åˆ°äººç‰©è¯¦æƒ…é¡µï¼Œè€Œæ˜¯ç›´æ¥å›åˆ°äº†äººç‰©åˆ—è¡¨é¡µã€‚åŒæ—¶ï¼Œæ²¡æœ‰é¢åŒ…å±‘å¯¼èˆªè®©ç”¨æˆ·æ¸…æ¥šäº†è§£å½“å‰æ‰€å¤„çš„å±‚çº§ä½ç½®ã€‚

### ç”¨æˆ·ä½“éªŒç—›ç‚¹

1. **å¯¼èˆªå±‚çº§ä¸¢å¤±**ï¼šä» `/photo/:id` è¿”å›æ—¶ï¼Œ`selectedPerson` çŠ¶æ€ä»ç„¶ä¿ç•™ï¼Œä½†ç”¨æˆ·æœŸæœ›çœ‹åˆ°äººç‰©åˆ—è¡¨è€Œéäººç‰©è¯¦æƒ…
2. **è®¤çŸ¥å¤±è°ƒ**ï¼šçŠ¶æ€é©±åŠ¨è§†å›¾çš„å®ç°ä¸ç¬¦åˆç”¨æˆ·å¯¹å±‚çº§å¯¼èˆªçš„å¿ƒæ™ºæ¨¡å‹
3. **ç¼ºå°‘é€ƒç”Ÿèˆ±**ï¼šæ²¡æœ‰é¢åŒ…å±‘å¯¼èˆªè®©ç”¨æˆ·å¿«é€Ÿè·³è½¬åˆ°ä¸Šçº§é¡µé¢
4. **æ— æ³•åˆ†äº«**ï¼šäººç‰©è¯¦æƒ…æ²¡æœ‰ç‹¬ç«‹ URLï¼Œæ— æ³•ç›´æ¥åˆ†äº«æŸä¸ªäººç‰©çš„é“¾æ¥

---

## è§£å†³æ–¹æ¡ˆ

### æ¶æ„é‡æ„

é‡‡ç”¨ **é¢åŒ…å±‘å¯¼èˆª + å­è·¯ç”±é‡æ„** çš„ç»„åˆæ–¹æ¡ˆï¼š

```
æ—§æ¶æ„ï¼ˆçŠ¶æ€é©±åŠ¨ï¼‰ï¼š
/people
â”œâ”€â”€ äººç‰©åˆ—è¡¨è§†å›¾ (v-if="!selectedPerson")
â””â”€â”€ äººç‰©è¯¦æƒ…è§†å›¾ (v-else)  â† åŒä¸€ç»„ä»¶å†…åˆ‡æ¢
    â””â”€â”€ ç‚¹å‡»ç…§ç‰‡ â†’ /photo/:id

æ–°æ¶æ„ï¼ˆè·¯ç”±é©±åŠ¨ï¼‰ï¼š
/people                    â†’ PeopleViewï¼ˆäººç‰©åˆ—è¡¨ï¼‰
/people/:personId          â†’ PersonDetailViewï¼ˆäººç‰©è¯¦æƒ…ï¼‰â† ç‹¬ç«‹è·¯ç”±
    â””â”€â”€ ç‚¹å‡»ç…§ç‰‡ â†’ /photo/:id?from=person&personId=xxx
```

### å®ç°ç»†èŠ‚

#### 1. é¢åŒ…å±‘å¯¼èˆªç»„ä»¶
- **æ–‡ä»¶**: `src/renderer/components/nav/BreadcrumbNav.vue`
- **åŠŸèƒ½**: æ”¯æŒåŠ¨æ€é¢åŒ…å±‘é¡¹ã€å¯ç‚¹å‡»é“¾æ¥ã€å›¾æ ‡æ˜¾ç¤º
- **ç‰¹æ€§**: å“åº”å¼è®¾è®¡ã€æš—è‰²ä¸»é¢˜é€‚é…

#### 2. å­è·¯ç”±é…ç½®
```typescript
{
  path: '/people/:personId',
  name: 'PersonDetail',
  component: () => import('../views/PersonDetailView.vue'),
  props: true
}
```

#### 3. æ™ºèƒ½è¿”å›é€»è¾‘
ç…§ç‰‡è¯¦æƒ…é¡µæ ¹æ® `from` å‚æ•°å†³å®šè¿”å›ç›®æ ‡ï¼š
```typescript
const goBack = () => {
  if (route.query.from === 'person' && route.query.personId) {
    router.push(`/people/${route.query.personId}`)
  } else {
    router.back()
  }
}
```

#### 4. çŠ¶æ€æŒä¹…åŒ–
æ–°å¢ `lastVisitedPersonId` çŠ¶æ€ï¼Œä½¿ç”¨ localStorage æŒä¹…åŒ–ï¼š
```typescript
const lastVisitedPersonId = ref<number | null>(
  Number(localStorage.getItem('lastVisitedPersonId')) || null
)
```

---

## æ”¹åŠ¨æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `src/renderer/components/nav/BreadcrumbNav.vue` | ğŸ†• æ–°å¢ | é¢åŒ…å±‘å¯¼èˆªç»„ä»¶ |
| `src/renderer/utils/breadcrumbConfig.ts` | ğŸ†• æ–°å¢ | é¢åŒ…å±‘é…ç½®å·¥å…· |
| `src/renderer/router/index.ts` | âœï¸ ä¿®æ”¹ | æ·»åŠ  `/people/:personId` è·¯ç”± |
| `src/renderer/views/PersonDetailView.vue` | ğŸ†• æ–°å¢ | äººç‰©è¯¦æƒ…é¡µï¼ˆç‹¬ç«‹è·¯ç”±ï¼‰ |
| `src/renderer/views/PeopleView.vue` | âœï¸ ä¿®æ”¹ | ç‚¹å‡»äººç‰©è·³è½¬æ–°è·¯ç”±ï¼Œç§»é™¤å†…è”è¯¦æƒ… |
| `src/renderer/views/PhotoDetailView.vue` | âœï¸ ä¿®æ”¹ | æ™ºèƒ½è¿”å›é€»è¾‘ + é¢åŒ…å±‘ |
| `src/renderer/stores/peopleStore.ts` | âœï¸ ä¿®æ”¹ | æ–°å¢ `getPersonById` å’Œ `setLastVisitedPerson` |
| `tests/stores/peopleStore.spec.ts` | âœ… æ›´æ–° | æ›´æ–° API mockï¼Œæ–°å¢å¯¼èˆªçŠ¶æ€æµ‹è¯• |
| `tests/stores/peopleStore.test.ts` | âœ… æ›´æ–° | æ›´æ–° API mockï¼Œæ–°å¢å¯¼èˆªçŠ¶æ€æµ‹è¯• |

---

## ç”¨æˆ·æµç¨‹

```
ç”¨æˆ·æ“ä½œæµç¨‹:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£ è¿›å…¥äººç‰©åˆ—è¡¨
   /people â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PeopleView
                                              â”‚
   ç‚¹å‡»äººç‰©å¡ç‰‡ï¼ˆå¦‚"å¼ ä¸‰"ï¼‰                    â”‚
                                              â–¼
2ï¸âƒ£ è¿›å…¥äººç‰©è¯¦æƒ…ï¼ˆæ–°è·¯ç”±ï¼‰
   /people/123 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PersonDetailView
   é¢åŒ…å±‘: é¦–é¡µ > äººç‰© > å¼ ä¸‰                   â”‚
   è®°å½• lastVisitedPersonId = 123              â”‚
                                              â”‚
   ç‚¹å‡»æŸå¼ ç…§ç‰‡                                â”‚
                                              â–¼
3ï¸âƒ£ è¿›å…¥ç…§ç‰‡è¯¦æƒ…
   /photo/456?from=person&personId=123 â”€â†’ PhotoDetailView
   é¢åŒ…å±‘: é¦–é¡µ > äººç‰© > å¼ ä¸‰ > ç…§ç‰‡è¯¦æƒ…        â”‚
                                              â”‚
   ç‚¹å‡»è¿”å›æŒ‰é’®                                â”‚
                                              â–¼
4ï¸âƒ£ è¿”å›äººç‰©è¯¦æƒ…ï¼ˆè€Œéäººç‰©åˆ—è¡¨ï¼‰âœ…
   /people/123 â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PersonDetailView
   é¢åŒ…å±‘: é¦–é¡µ > äººç‰© > å¼ ä¸‰

5ï¸âƒ£ å†æ¬¡è¿”å›ï¼ˆå¯é€‰ï¼‰
   ç”¨æˆ·å¯ä»¥ç»§ç»­æµè§ˆï¼Œæˆ–ç‚¹å‡»é¢åŒ…å±‘"äººç‰©"è¿”å›åˆ—è¡¨
```

---

## æµ‹è¯•è¦†ç›–

### æ–°å¢æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | æ–‡ä»¶ | çŠ¶æ€ |
|----------|------|------|
| lastVisitedPersonId åˆå§‹çŠ¶æ€ | peopleStore.spec.ts | âœ… é€šè¿‡ |
| è®¾ç½®å’ŒæŒä¹…åŒ– lastVisitedPersonId | peopleStore.spec.ts | âœ… é€šè¿‡ |
| æ¸…é™¤ lastVisitedPersonId | peopleStore.spec.ts | âœ… é€šè¿‡ |
| ä»ç¼“å­˜è·å–äººç‰© | peopleStore.spec.ts | âœ… é€šè¿‡ |
| ä» API è·å–äººç‰©ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰| peopleStore.spec.ts | âœ… é€šè¿‡ |
| getPersonById é”™è¯¯å¤„ç† | peopleStore.spec.ts | âœ… é€šè¿‡ |
| Navigation State é›†æˆæµ‹è¯• | peopleStore.test.ts | âœ… é€šè¿‡ |

### æµ‹è¯•ç»“æœ

```
Test Files: 2 passed (2)
Tests:      43 passed (43)
Duration:   399ms
```

---

## è§£å†³çš„é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | çŠ¶æ€ |
|------|----------|------|
| ä»ç…§ç‰‡è¯¦æƒ…è¿”å›æ—¶ä¸¢å¤±äººç‰©è¯¦æƒ…ä¸Šä¸‹æ–‡ | ä½¿ç”¨ `from=person` å‚æ•°æ ‡è¯†æ¥æº | âœ… è§£å†³ |
| æ²¡æœ‰é¢åŒ…å±‘å¯¼èˆª | æ–°å¢ BreadcrumbNav ç»„ä»¶ | âœ… è§£å†³ |
| æ— æ³•ç›´æ¥åˆ†äº«äººç‰©é¡µé¢ | äººç‰©è¯¦æƒ…æ”¹ä¸ºç‹¬ç«‹è·¯ç”± `/people/:id` | âœ… è§£å†³ |
| åˆ·æ–°é¡µé¢åçŠ¶æ€ä¸¢å¤± | ä½¿ç”¨ localStorage æŒä¹…åŒ– lastVisitedPersonId | âœ… è§£å†³ |
| URL æ— æ³•åæ˜ å½“å‰è§†å›¾ | å­è·¯ç”±æ¶æ„ï¼Œæ¯ä¸ªå±‚çº§æœ‰ç‹¬ç«‹ URL | âœ… è§£å†³ |

---

## æŠ€æœ¯å€ºåŠ¡

æ— æ–°å¢æŠ€æœ¯å€ºåŠ¡ã€‚æ‰€æœ‰æ”¹åŠ¨ï¼š
- âœ… å‘åå…¼å®¹ï¼ˆ`selectedPerson` ä»ä¿ç•™ä½†ä¸å†ä½¿ç”¨ï¼‰
- âœ… æµ‹è¯•è¦†ç›–å®Œæ•´
- âœ… ä»£ç ç¬¦åˆç°æœ‰é£æ ¼

---

## åç»­ä¼˜åŒ–å»ºè®®

1. **æ‰©å±•é¢åŒ…å±‘åˆ°å…¶ä»–é¡µé¢**ï¼šç›¸å†Œè¯¦æƒ…ã€æ—¶é—´çº¿è¯¦æƒ…ç­‰
2. **æ·»åŠ é¡µé¢åˆ‡æ¢åŠ¨ç”»**ï¼šæå‡ç”¨æˆ·ä½“éªŒ
3. **æ”¯æŒæµè§ˆå™¨å‰è¿›/åé€€æ‰‹åŠ¿**ï¼šç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–

---

## ç›¸å…³æ–‡æ¡£

- [UX è®¾è®¡æ–‡æ¡£](./e-09-person-navigation-refactor-design.md) - è¯¦ç»†è®¾è®¡æ–‡æ¡£
- [API æ–‡æ¡£](../../project_knowledge/api/people-api.md) - peopleAPI æ¥å£æ–‡æ¡£
