import{P as H}from"./PhotoGrid-CbLsguGP.js";import{C as L}from"./CalendarToday24Regular-C2OphPV9.js";import{d as O,u as R,r as m,q as Z,b as J,c as p,a as o,e as s,w as i,F as A,l as T,s as C,f as c,o as u,j as M,i as P,t as h,h as K,k as Y}from"./index-b2OWAZnp.js";import{_ as Q}from"./_plugin-vue_export-helper-DZzl9uFm.js";const W={class:"timeline-container"},X={class:"header"},ee={class:"header-right"},te={class:"year-tabs"},ne={key:0,class:"timeline-content"},ae={class:"month-header"},oe={class:"photo-count"},se={key:1,class:"empty-state"},le={key:1,class:"loading-state"},re={key:0,class:"photo-preview"},ie={class:"preview-image"},ce={class:"preview-info"},ue=O({__name:"TimelineView",props:{year:{}},setup(N){const v=N;R();const g=m(!0),d=m(new Date().getFullYear()),f=m(null),_=m([]),S=m(!1),l=m(null),F=()=>!!window.photoAPI,x=(t,e=20)=>{const n=[{name:"日本东京",lat:35.6762,lng:139.6503},{name:"新疆乌鲁木齐",lat:43.8256,lng:87.6168},{name:"北京",lat:39.9042,lng:116.4074}];return Array.from({length:e},(y,r)=>{const k=r%12+1,b=r%28+1;return{id:r,uuid:`timeline-${t}-${r}`,fileName:`IMG_${t}${String(k).padStart(2,"0")}${String(b).padStart(2,"0")}_${r}.jpg`,takenAt:`${t}-${String(k).padStart(2,"0")}-${String(b).padStart(2,"0")}T10:30:00Z`,location:n[r%n.length]}})},I=C(()=>{const t=new Date().getFullYear(),e=[];for(let n=t;n>=2015;n--)e.push(n);return e}),D=C(()=>{const t={};for(const e of _.value){const n=new Date(e.takenAt).getMonth()+1;t[n]||(t[n]=[]),t[n].push(e)}return Object.entries(t).map(([e,n])=>({month:parseInt(e),photos:n.sort((y,r)=>new Date(r.takenAt).getTime()-new Date(y.treatAt).getTime())})).sort((e,n)=>n.month-e.month)}),V=t=>["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"][t-1],j=t=>{if(t){const e=new Date(t);d.value=e.getFullYear()}w()},w=async()=>{g.value=!0,_.value=[];try{if(F()){const t=await window.photoAPI.timeline.get(d.value);_.value=t||[]}else await new Promise(t=>setTimeout(t,500)),_.value=x(d.value,20)}catch(t){console.error("加载照片失败:",t),_.value=x(d.value,20)}finally{g.value=!1}},B=t=>{l.value=t,S.value=!0},U=t=>{if(!t)return"-";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`};return Z(()=>v.year,t=>{t&&(d.value=t,f.value=t,w())},{immediate:!0}),J(()=>{v.year&&(d.value=v.year,f.value=v.year),w()}),(t,e)=>{const n=c("n-date-picker"),y=c("n-tab"),r=c("n-tabs"),k=c("n-icon"),b=c("n-empty"),z=c("n-spin"),G=c("n-image"),$=c("n-descriptions-item"),q=c("n-descriptions"),E=c("n-modal");return u(),p("div",W,[o("header",X,[e[3]||(e[3]=o("div",{class:"header-left"},[o("h1",null,"时间线"),o("p",{class:"subtitle"},"按时间回顾美好回忆")],-1)),o("div",ee,[s(n,{value:f.value,"onUpdate:value":[e[0]||(e[0]=a=>f.value=a),j],type:"year",placeholder:"选择年份",clearable:"",style:{width:"150px"}},null,8,["value"])])]),o("div",te,[s(r,{value:d.value,"onUpdate:value":[e[1]||(e[1]=a=>d.value=a),w],type:"card"},{default:i(()=>[(u(!0),p(A,null,T(I.value,a=>(u(),M(y,{name:a,key:a},{default:i(()=>[P(h(a)+" 年 ",1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])]),g.value?(u(),p("div",le,[s(z,{size:"large"}),e[4]||(e[4]=o("p",null,"加载中...",-1))])):(u(),p("div",ne,[D.value.length>0?(u(!0),p(A,{key:0},T(D.value,a=>(u(),p("div",{key:a.month,class:"month-group"},[o("div",ae,[o("h2",null,h(V(a.month)),1),o("span",oe,h(a.photos.length)+" 张照片",1)]),s(H,{photos:a.photos,columns:4,onPhotoClick:B},null,8,["photos"])]))),128)):(u(),p("div",se,[s(b,{description:g.value?"加载中...":"该年份暂无照片"},{icon:i(()=>[s(k,{size:"64",color:"#ccc"},{default:i(()=>[s(K(L))]),_:1})]),_:1},8,["description"])]))])),s(E,{show:S.value,"onUpdate:show":e[2]||(e[2]=a=>S.value=a),preset:"card",style:{width:"90%","max-width":"900px"}},{header:i(()=>[...e[5]||(e[5]=[o("span",null,"照片详情",-1)])]),default:i(()=>[l.value?(u(),p("div",re,[o("div",ie,[s(G,{src:l.value.thumbnailPath||l.value.thumbnail_url,"preview-src":l.value.thumbnailPath||l.value.thumbnail_url,"object-fit":"contain",style:{width:"100%","max-height":"500px"}},null,8,["src","preview-src"])]),o("div",ce,[s(q,{column:1,"label-placement":"left"},{default:i(()=>[s($,{label:"文件名"},{default:i(()=>[P(h(l.value.fileName),1)]),_:1}),s($,{label:"拍摄时间"},{default:i(()=>[P(h(U(l.value.takenAt)),1)]),_:1}),l.value.location?.name?(u(),M($,{key:0,label:"地点"},{default:i(()=>[P(h(l.value.location.name),1)]),_:1})):Y("",!0)]),_:1})])])):Y("",!0)]),_:1},8,["show"])])}}}),_e=Q(ue,[["__scopeId","data-v-926b7745"]]);export{_e as default};
